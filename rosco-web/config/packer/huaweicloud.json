{
  "variables": {
    "huaweicloud_domain_name": null,
    "huaweicloud_instance_type": null,
    "huaweicloud_network_id": null,
    "huaweicloud_floating_ip_pool": null,
    "huaweicloud_image_name": null,
    "huaweicloud_auth_url": null,
    "huaweicloud_insecure": "false",
    "huaweicloud_source_image_id": null,
    "huaweicloud_ssh_username": null,
    "huaweicloud_username": "{{env `OS_USERNAME`}}",
    "huaweicloud_password": "{{env `OS_PASSWORD`}}",
    "huaweicloud_region": null,
    "huaweicloud_security_groups": null,
    "huaweicloud_project_name": null,
    "appversion": "",
    "build_host": "",
    "build_info_url": "",
    "repository": "",
    "package_type": "",
    "packages": "",
    "upgrade": "",
    "configDir": null
    },
  "builders": [
    {
      "type": "huaweicloud",
      "domain_name": "{{user `huaweicloud_domain_name`}}",
      "flavor": "{{user `huaweicloud_instance_type`}}",
      "networks": [ "{{user `huaweicloud_network_id`}}" ],
      "floating_ip_pool": "{{user `huaweicloud_floating_ip_pool`}}",
      "image_name": "{{user `huaweicloud_image_name`}}",
      "identity_endpoint": "{{user `huaweicloud_auth_url`}}",
      "insecure": "{{user `huaweicloud_insecure`}}",
      "metadata": {"appversion": "{{user `appversion`}}", "build_host": "{{user `build_host`}}", "build_info_url": "{{user `build_info_url`}}"},
      "region": "{{user `huaweicloud_region`}}",
      "ssh_username": "{{user `huaweicloud_ssh_username`}}",
      "source_image": "{{user `huaweicloud_source_image_id`}}",
      "username": "{{user `huaweicloud_username`}}",
      "password": "{{user `huaweicloud_password`}}",
      "security_groups": "{{user `huaweicloud_security_groups`}}",
      "tenant_name": "{{user `huaweicloud_project_name`}}"
    }
  ],
  "provisioners": [
    {
      "type": "shell",
      "script": "{{user `configDir`}}/install_packages.sh",
      "environment_vars": [
        "repository={{user `repository`}}",
        "package_type={{user `package_type`}}",
        "packages={{user `packages`}}",
        "upgrade={{user `upgrade`}}"
      ],
      "pause_before": "30s"
    }
  ]
}
